<div class="main-header">
    <div class="results-header">
        <strong>Resultados para a Conta:</strong> {{ form_data.account_name }} | <strong>Per√≠odo:</strong> {{ form_data.start_date }} a {{ form_data.end_date }}
    </div>
    <div class="header-actions">
        <a href="{{ url_for('logout') }}">Sair / Nova An√°lise</a>
    </div>
</div>

{% if is_simulation %}
<div class="simulation-warning">
    <strong>Modo de Simula√ß√£o Ativado.</strong> Os resultados abaixo excluem os pares da blacklist. 
    <button id="restore-btn" style="margin-left: 15px; background: #1A202C; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Restaurar An√°lise Original</button>
</div>
{% endif %}

<div class="kpi-container">
    <div class="kpi-card">
        <h3>PnL de Trades (USDT)</h3>
        <div class="kpi-value {{ 'positive' if kpis.total_pnl > 0 else 'negative' }}">
            {{ "%.2f"|format(kpis.total_pnl) }}
        </div>
    </div>
    <div class="kpi-card">
        <h3>Custo Total (Margem)</h3>
        <div class="kpi-value">
            {{ "%.2f"|format(kpis.total_margin_cost) }} USDT
        </div>
    </div>
    <div class="kpi-card">
        <h3>Taxa de Acerto</h3>
        <div class="kpi-value">
            {{ "%.2f"|format(kpis.win_rate) }}%
        </div>
    </div>
    <div class="kpi-card">
        <h3>ROI Agregado Total</h3>
        <div class="kpi-value {{ 'positive' if kpis.avg_roi > 0 else 'negative' }}">
            {{ "%.2f"|format(kpis.avg_roi) }}%
        </div>
    </div>
    <!-- NOVO CARD ADICIONADO ABAIXO -->
    <div class="kpi-card">
        <h3>Total de Trades</h3>
        <div class="kpi-value">
            {{ kpis.total_trades }}
        </div>
    </div>
</div>

<div class="tabs">
    <button class="tab-link active" data-tab="winners-tab">üèÜ Ganhadores</button>
    <button class="tab-link" data-tab="losers-tab">üíî Perdedores</button>
    <button class="tab-link" data-tab="exit-type-tab">üìä Por Sa√≠da</button>
</div>

<div id="winners-tab" class="tab-content" style="display: block;">
    <h3>üèÜ Ranking de Ganhadores</h3>
    <table id="winners-table" class="results-table">
        <thead>
            <tr>
                <th>Par</th>
                <th>PnL Total (USDT)</th>
                <th>ROI Agregado (%)</th>
                <th>Taxa de Acerto (%)</th>
                <th>N¬∫ de Trades</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for row in winners_summary %}
            <tr>
                <td><a href="{{ url_for('trade_details', symbol=row.symbol) }}" target="_blank">{{ row.symbol }}</a></td>
                <td class="positive">+{{ "%.2f"|format(row.total_pnl_net) }}</td>
                <td class="{{ 'positive' if row.roi_agregado > 0 else 'negative' }}">{{ "%.2f"|format(row.roi_agregado) }}</td>
                <td>{{ "%.2f"|format(row.win_rate) }}</td>
                <td>{{ row.trade_count }}</td>
                <td>
                    <div class="action-menu-container">
                        <button class="action-menu-button">‚ãÆ</button>
                        <div class="action-menu-dropdown">
                            <a href="{{ url_for('trade_details', symbol=row.symbol) }}" target="_blank">Ver Detalhes</a>
                            <button class="ban-btn ban-option" data-symbol="{{ row.symbol }}">Banir Par</button>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div id="losers-tab" class="tab-content">
    <h3>üíî Ranking de Perdedores</h3>
    <table id="losers-table" class="results-table">
        <thead>
            <tr>
                <th>Par</th>
                <th>PnL Total (USDT)</th>
                <th>ROI Agregado (%)</th>
                <th>Taxa de Acerto (%)</th>
                <th>N¬∫ de Trades</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for row in losers_summary %}
            <tr>
                <td><a href="{{ url_for('trade_details', symbol=row.symbol) }}" target="_blank">{{ row.symbol }}</a></td>
                <td class="negative">{{ "%.2f"|format(row.total_pnl_net) }}</td>
                <td class="{{ 'positive' if row.roi_agregado > 0 else 'negative' }}">{{ "%.2f"|format(row.roi_agregado) }}</td>
                <td>{{ "%.2f"|format(row.win_rate) }}</td>
                <td>{{ row.trade_count }}</td>
                <td>
                    <div class="action-menu-container">
                        <button class="action-menu-button">‚ãÆ</button>
                        <div class="action-menu-dropdown">
                            <a href="{{ url_for('trade_details', symbol=row.symbol) }}" target="_blank">Ver Detalhes</a>
                            <button class="ban-btn ban-option" data-symbol="{{ row.symbol }}">Banir Par</button>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div id="exit-type-tab" class="tab-content">
    <h3>üìä Resumo por Tipo de Sa√≠da</h3>
    <table id="exit-type-table" class="results-table">
        <thead>
            <tr>
                <th>Tipo de Sa√≠da</th>
                <th>PnL Total (USDT)</th>
                <th>ROI Agregado (%)</th>
                <th>Taxa de Acerto (%)</th>
                <th>N¬∫ de Sa√≠das</th>
            </tr>
        </thead>
        <tbody>
            {% for row in exit_type_summary %}
            <tr>
                <td>{{ row.exit_type }}</td>
                <td class="{{ 'positive' if row.total_pnl_net > 0 else 'negative' }}">{{ "%.2f"|format(row.total_pnl_net) }}</td>
                <td class="{{ 'positive' if row.roi_agregado > 0 else 'negative' }}">{{ "%.2f"|format(row.roi_agregado) }}</td>
                <td>{{ "%.2f"|format(row.win_rate) }}</td>
                <td>{{ row.exit_count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
